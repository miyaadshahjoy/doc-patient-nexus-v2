const express = require('express');
const morgan = require('morgan');
const globalErrorHandler = require('./controllers/errorController');

const doctorRouter = require('./routes/doctorsRoutes');

const app = express();

app.get('/', (req, res) => {
  res.status(200);
  res.json({
    status: 'success',
    data: 'Homepage',
  });
});

// middlewares
// 3rd party middlewares
// body parser middleware
app.use(express.json());
app.use(morgan('dev'));

//Routes
app.use('/api/v2/doctors', doctorRouter);

// handler function for unhandled routes
app.all('*wildcard', (req, res) => {
  res.status(404).json({
    status: 'fail',
    message: `Can't find ${req.originalUrl}  on this server`,
  });
});

// Global Error Handling Middleware
app.use(globalErrorHandler);
module.exports = app;
/////////////////////////////////////////////////////////////////////////////////////
/*
const fs = require('fs');
const http = require('http');
const stream = fs.createWriteStream('./large.file');

for (let i = 0; i < 1e6; i++) {
  stream.write(
    'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n'
  );
}
stream.end();

const server = http.createServer((req, res) => {
  const readStream = fs.createReadStream('./large.file', 'utf-8');
  res.writeHead(200, {
    'Content-Type': 'text/plain',
    'Content-Encoding': 'identity', // or gzip later
    'Transfer-Encoding': 'chunked',
  });
  readStream.pipe(res);
});
server.listen(3000);
const fs = require('fs');

console.log('üü¢ 1. Start of script');

setTimeout(() => {
  console.log('‚è±  5. Timeout callback (Timers Phase)');
}, 0);

setImmediate(() => {
  console.log('‚ö° 6. setImmediate callback (Check Phase)');
});

fs.readFile(__filename, () => {
  console.log('üìÑ 7. File read complete (Poll Phase)');

  setTimeout(() => {
    console.log('‚è±  11. Timeout inside fs.readFile (Timers Phase)');
  }, 0);

  setImmediate(() => {
    console.log('‚ö° 10. setImmediate inside fs.readFile (Check Phase)');
  });

  process.nextTick(() => {
    console.log('‚è≠Ô∏è  8. nextTick inside fs.readFile (Microtask)');
  });

  Promise.resolve().then(() => {
    console.log('‚úÖ 9. Promise inside fs.readFile (Microtask)');
  });
});

process.nextTick(() => {
  console.log('‚è≠Ô∏è  3. nextTick (Microtask)');
});

Promise.resolve().then(() => {
  console.log('‚úÖ 4. Promise (Microtask)');
});

console.log('üî¥ 2. End of script');
*/

/*
const fs = require('fs');

console.log('üü¢ 1. Start of script');

setTimeout(() => {
  console.log('‚è±  5. Timeout callback (Timers Phase)');
}, 0);

setImmediate(() => {
  console.log('‚ö° 6. setImmediate callback (Check Phase)');
});

// Synchronous read (Blocking)
fs.readFileSync(__filename);

process.nextTick(() => {
  console.log('‚è≠Ô∏è  3. nextTick (Microtask)');
});

Promise.resolve().then(() => {
  console.log('‚úÖ 4. Promise (Microtask)');
});

console.log('üî¥ 2. End of script');
*/
/*
console.log('üü¢ 1. Start');

setTimeout(() => {
  console.log('‚è±  5. Timeout');
}, 0);

Promise.resolve().then(() => {
  console.log('‚úÖ 4. Promise');
});

process.nextTick(() => {
  console.log('‚è≠Ô∏è  3. nextTick');
});

console.log('üî¥ 2. End');
*/
/*
setTimeout(() => {
  console.log('‚è±  1. Outer Timeout');

  setTimeout(() => {
    console.log('‚è±  3. Inner Timeout');
  }, 0);

  setImmediate(() => {
    console.log('‚ö° 2. Inner setImmediate');
  });
}, 0);
*/
/*
const start = Date.now();
console.log('üü¢ 1. Start');

setTimeout(() => {
  console.log('‚è±  3. Timeout after block');
}, 0);

while (Date.now() - start < 1000) {
  // Blocking for 1 second
}

console.log('üî¥ 2. Done blocking');
*/
/*
const fs = require('fs');

fs.readFile(__filename, () => {
  console.log('üìÑ 3. Finished reading file');

  setTimeout(() => {
    console.log('‚è±  5. Timeout inside readFile');
  }, 0);

  setImmediate(() => {
    console.log('‚ö° 4. Immediate inside readFile');
  });
});

setTimeout(() => {
  console.log('‚è±  1. Outside timeout');
}, 0);

setImmediate(() => {
  console.log('‚ö° 2. Outside immediate');
});
*/
/*
setTimeout(() => {
  console.log('‚è±  1. Start long task');

  const start = Date.now();
  while (Date.now() - start < 1000) {} // block for 1s

  console.log('‚è±  2. End long task');
}, 0);

setImmediate(() => {
  console.log('‚ö° 3. Immediate after blocking');
});
*/
/*
const fs = require('fs');

console.log('üîµ 1. Start');

setTimeout(() => {
  console.log('‚è±  5. Timer 1 (Timers phase)');
}, 0);

setImmediate(() => {
  console.log('‚ö° 6. setImmediate 1 (Check phase)');
});

fs.readFile(__filename, () => {
  console.log('üìÑ 7. File Read Callback (Poll phase)');

  setTimeout(() => {
    console.log('‚è±  11. Timer 2 inside fs.readFile (Timers phase)');
  }, 0);

  setImmediate(() => {
    console.log('‚ö° 10. setImmediate 2 inside fs.readFile (Check phase)');
  });

  process.nextTick(() => {
    console.log('üîÅ 8. nextTick inside fs.readFile (Microtask)');
  });

  Promise.resolve().then(() => {
    console.log('‚úÖ 9. Promise inside fs.readFile (Microtask)');
  });
});

process.nextTick(() => {
  console.log('üîÅ 3 .nextTick (Microtask)');
});

Promise.resolve().then(() => {
  console.log('‚úÖ 4. Promise (Microtask)');
});

console.log('üî¥ 2. End');
*/
/*
const fs = require('fs');

fs.readFile(__filename, () => {
  console.log('üìÑ 4. File read complete (Poll phase)');
});

setImmediate(() => {
  console.log('‚ö° 3. setImmediate (Check phase)');
});

setTimeout(() => {
  console.log('‚è±  2. setTimeout (Timers phase)');
}, 0);

const start = Date.now();
while (Date.now() - start < 500) {} // Blocking loop

console.log('üî¥ 1. End of script');
*/
/*
const net = require('net');

const server = net.createServer((socket) => {
  socket.end('Goodbye\n');
});

server.listen(8080, () => {
  const client = net.connect(8080);
  client.on('data', (data) => {
    console.log('üì© Received:', data.toString());
  });

  client.on('end', () => {
    console.log('üîí Client disconnected (Close callback phase)');
  });
});
*/
/*
setTimeout(() => {
  console.log('‚è±  3. Timeout 1');

  Promise.resolve().then(() => {
    console.log('‚úÖ 4. Promise inside Timeout 1');

    setTimeout(() => {
      console.log('‚è±  5. Timeout 2');
    }, 0);
  });
}, 0);

Promise.resolve().then(() => {
  console.log('‚úÖ 2. Top-level Promise');
});

console.log('üîµ 1. Synchronous code');
*/
/*
console.log('üü¢ 1. Start');

setTimeout(() => {
  console.log('‚è±  6. Timeout');
}, 0);

setImmediate(() => {
  console.log('‚ö° 5. setImmediate');
});

Promise.resolve().then(() => {
  console.log('‚úÖ 4. Promise');
});

process.nextTick(() => {
  console.log('üîÅ 3. nextTick');
});

const start = Date.now();
while (Date.now() - start < 1000) {} // Simulate CPU-heavy task

console.log('üî¥ 2. End');
*/
/*
const fs = require('fs');

console.log('üü¢ 1. Start');

fs.readFile(__filename, () => {
  console.log('üìÑ 2. File Read Complete (Poll Phase)');

  setImmediate(() => {
    console.log('‚ö° 5. setImmediate (Check Phase)');
  });

  setTimeout(() => {
    console.log('‚è±  6. setTimeout (Timers Phase)');
  }, 0);

  process.nextTick(() => {
    console.log('üîÅ 3. nextTick inside fs.readFile (Microtask)');
  });

  Promise.resolve().then(() => {
    console.log('‚úÖ 4. Promise inside fs.readFile (Microtask)');
  });
});

setImmediate(() => {
  console.log('‚ö° 7. setImmediate outside (Check Phase)');
});

console.log('üî¥ End');
*/
/*
console.log('üü¢ 1. Start');

process.nextTick(() => {
  console.log('üîÅ 3. nextTick 1');

  process.nextTick(() => {
    console.log('üîÅ 4. nextTick 2');

    process.nextTick(() => {
      console.log('üîÅ 5. nextTick 3');
    });
  });
});

setTimeout(() => {
  console.log('‚è±  6. Timeout');
}, 0);

console.log('üî¥ 2. End');
*/

/*
const fs = require('fs');

fs.readFile(__filename, () => {
  setTimeout(() => {
    console.log('‚è±  2.Timeout inside readFile');
  }, 0);

  setImmediate(() => {
    console.log('‚ö° 1. setImmediate inside readFile');
  });
});

*/
/*
console.log('üü¢ 1. Start');

for (let i = 0; i < 10000; i++) {
  process.nextTick(() => {});
}

setTimeout(() => {
  console.log('‚è±  3. Timeout');
}, 0);

console.log('üî¥ 2. End');
*/
/*
const fs = require('fs');

console.log('üü¢ 1. Start');

setTimeout(() => {
  console.log('‚è±  5. Outer setTimeout (Timers Phase)');

  Promise.resolve().then(() => {
    console.log('‚úÖ 6. Microtask in Outer setTimeout');
  });

  setImmediate(() => {
    console.log('‚ö° 8. setImmediate inside setTimeout');
  });
}, 0);

fs.readFile(__filename, () => {
  console.log('üìÑ 9. File Read Complete (Poll Phase)');

  setTimeout(() => {
    console.log('‚è±  15. setTimeout inside fs.readFile (Timers Phase)');
  }, 0);

  setImmediate(() => {
    console.log('‚ö° 14. setImmediate inside fs.readFile (Check Phase)');
  });

  process.nextTick(() => {
    console.log('üîÅ 10. nextTick inside fs.readFile');
    process.nextTick(() => {
      console.log('üîÅ 11. Nested nextTick');
    });
  });

  Promise.resolve().then(() => {
    console.log('‚úÖ 12. Promise inside fs.readFile');
    Promise.resolve().then(() => {
      console.log('‚úÖ 13. Nested Promise');
    });
  });
});

setImmediate(() => {
  console.log('‚ö° 7. setImmediate outside (Check Phase)');
});

process.nextTick(() => {
  console.log('üîÅ 3. nextTick (global)');
});

Promise.resolve().then(() => {
  console.log('‚úÖ 4. Promise (global)');
});

const start = Date.now();
while (Date.now() - start < 100) {} // Simulate 100ms CPU block

console.log('üî¥ 2. End');
*/

/*
const fs = require('fs');

console.log('üü¢ 1. Start');

setTimeout(() => {
  //1
  console.log('‚è±  5. Outer setTimeout (Timers Phase)');

  process.nextTick(() => {
    console.log('üîÅ 6. nextTick inside setTimeout');
  });

  Promise.resolve().then(() => {
    console.log('‚úÖ 7. Promise inside setTimeout');
  });

  fs.readFile(__filename, () => {
    //2
    console.log('üìÑ 11. Nested fs.readFile inside setTimeout (Poll Phase)');

    setImmediate(() => {
      //3
      console.log('‚ö° 16. setImmediate inside nested fs.readFile');
    });

    process.nextTick(() => {
      console.log('üîÅ 12. nextTick inside nested fs.readFile');
    });
  });
}, 0);

fs.readFile(__filename, () => {
  //1
  console.log('üìÑ 8. Top-level fs.readFile (Poll Phase)');

  setTimeout(() => {
    //2
    console.log('‚è±  13. setTimeout inside top-level fs.readFile');
  }, 0);

  setImmediate(() => {
    //2
    console.log('‚ö° 15. setImmediate inside top-level fs.readFile');
  });

  process.nextTick(() => {
    console.log('üîÅ 9. nextTick inside top-level fs.readFile');
  });

  Promise.resolve().then(() => {
    console.log('‚úÖ 10. Promise inside top-level fs.readFile');
  });
});

setImmediate(() => {
  //1
  console.log('‚ö° 14. Top-level setImmediate (Check Phase)');
});

process.nextTick(() => {
  console.log('üîÅ 3. Global nextTick');
});

Promise.resolve().then(() => {
  console.log('‚úÖ 4. Global Promise');
});

console.log('üî¥ 2. End');
*/
/*
const fs = require('fs');

console.log('üü¢ 1. Start');

setTimeout(() => {//1
  console.log('‚è∞ 2. setTimeout 1 (Timers Phase)');

  Promise.resolve().then(() => {
    console.log('‚úÖ 3. Promise inside setTimeout 1 (Microtask)');
  });

  process.nextTick(() => {
    console.log('üîÅ 4. nextTick inside setTimeout 1');
  });

  fs.readFile(__filename, () => {//2
    console.log('üìÑ 5. readFile inside setTimeout 1 (Poll Phase)');

    setImmediate(() => {//2
      console.log('‚ö° 6. setImmediate inside readFile');
    });
  });
}, 0);

setImmediate(() => {//1
  console.log('‚ö° 7. setImmediate 1 (Check Phase)');

  process.nextTick(() => {
    console.log('üîÅ 8. nextTick inside setImmediate');
  });

  Promise.resolve().then(() => {
    console.log('‚úÖ 9. Promise inside setImmediate');
  });
});

fs.readFile(__filename, () => {//1
  console.log('üìÑ 10. Top-level readFile (Poll Phase)');

  setTimeout(() => {//2
    console.log('‚è∞ 11. setTimeout inside readFile (Timers Phase)');
  }, 0);
});

process.nextTick(() => {
  console.log('üîÅ 12. Global nextTick');
});

Promise.resolve().then(() => {
  console.log('‚úÖ 13. Global Promise');
});

console.log('üî¥ 14. End');
*/

//  üü¢ 1. Start'
//  üî¥ 14. End
//  üîÅ 12. Global nextTick
//  ‚úÖ 13. Global Promise
//  ‚è± 2. setTimeout 1 (Timers Phase)
//  üîÅ 4. nextTick inside setTimeout
//  ‚úÖ 3. Promise inside setTimeout 1 (Microtask)
//  üìÑ 10. Top-level readFile (Poll Phase)
//  üìÑ 5. readFile inside setTimeout 1 (Poll Phase)
//  ‚ö° 7. setImmediate 1 (Check Phase)
//  üîÅ 8. nextTick inside setImmediate
//  ‚úÖ 9. Promise inside setImmediate
//  ‚è∞ 11. setTimeout inside readFile (Timers Phase)
//  ‚ö° 6. setImmediate inside readFile
/*
const fs = require('fs');
const file = fs.createWriteStream('./big.file');

for (let i = 0; i <= 1e6; i++) {
  file.write(
    'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n'
  );
}

file.end();

*/
